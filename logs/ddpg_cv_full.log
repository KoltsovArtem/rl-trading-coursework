/home/artem/PycharmProjects/Book/rl-trading-coursework/src/sb3_examples/train_validate_ddpg_portfolio.py:122: DeprecationWarning: Conversion of an array with ndim > 0 to a scalar is deprecated, and will error in future. Ensure you extract a single element from your array before performing this operation. (Deprecated NumPy 1.25.)
  turb_values[i] = float(delta.T.dot(inv_cov).dot(delta))
>>> Начинаем обучение Improved DDPG (Train портфель) …
Using cpu device
/home/artem/PycharmProjects/Book/rl-trading-coursework/.venv/lib/python3.12/site-packages/stable_baselines3/common/vec_env/patch_gym.py:49: UserWarning: You provided an OpenAI Gym environment. We strongly recommend transitioning to Gymnasium environments. Stable-Baselines3 is automatically wrapping your environments in a compatibility layer, which could potentially cause issues.
  warnings.warn(
Wrapping the env with a `Monitor` wrapper
Wrapping the env in a DummyVecEnv.
Logging to /home/artem/PycharmProjects/Book/rl-trading-coursework/logs/ddpg_improved_portfolio/DDPG_1
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 6.73e+04  |
| time/              |           |
|    episodes        | 4         |
|    fps             | 196       |
|    time_elapsed    | 46        |
|    total_timesteps | 9052      |
| train/             |           |
|    actor_loss      | -6.64e+03 |
|    critic_loss     | 2.57e+06  |
|    learning_rate   | 0.001     |
|    n_updates       | 8951      |
----------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 5.42e+04  |
| time/              |           |
|    episodes        | 8         |
|    fps             | 198       |
|    time_elapsed    | 91        |
|    total_timesteps | 18104     |
| train/             |           |
|    actor_loss      | -1.65e+04 |
|    critic_loss     | 1.05e+06  |
|    learning_rate   | 0.001     |
|    n_updates       | 18003     |
----------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 5.67e+04  |
| time/              |           |
|    episodes        | 12        |
|    fps             | 199       |
|    time_elapsed    | 136       |
|    total_timesteps | 27156     |
| train/             |           |
|    actor_loss      | -2.63e+04 |
|    critic_loss     | 1.42e+06  |
|    learning_rate   | 0.001     |
|    n_updates       | 27055     |
----------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 5.65e+04  |
| time/              |           |
|    episodes        | 16        |
|    fps             | 198       |
|    time_elapsed    | 181       |
|    total_timesteps | 36208     |
| train/             |           |
|    actor_loss      | -3.11e+04 |
|    critic_loss     | 1.01e+06  |
|    learning_rate   | 0.001     |
|    n_updates       | 36107     |
----------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 5.8e+04   |
| time/              |           |
|    episodes        | 20        |
|    fps             | 198       |
|    time_elapsed    | 227       |
|    total_timesteps | 45260     |
| train/             |           |
|    actor_loss      | -3.35e+04 |
|    critic_loss     | 8.51e+05  |
|    learning_rate   | 0.001     |
|    n_updates       | 45159     |
----------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 5.99e+04  |
| time/              |           |
|    episodes        | 24        |
|    fps             | 199       |
|    time_elapsed    | 272       |
|    total_timesteps | 54312     |
| train/             |           |
|    actor_loss      | -3.48e+04 |
|    critic_loss     | 1.18e+06  |
|    learning_rate   | 0.001     |
|    n_updates       | 54211     |
----------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 6.08e+04  |
| time/              |           |
|    episodes        | 28        |
|    fps             | 198       |
|    time_elapsed    | 318       |
|    total_timesteps | 63364     |
| train/             |           |
|    actor_loss      | -3.47e+04 |
|    critic_loss     | 9.13e+05  |
|    learning_rate   | 0.001     |
|    n_updates       | 63263     |
----------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 6.24e+04  |
| time/              |           |
|    episodes        | 32        |
|    fps             | 198       |
|    time_elapsed    | 364       |
|    total_timesteps | 72416     |
| train/             |           |
|    actor_loss      | -3.46e+04 |
|    critic_loss     | 8.61e+05  |
|    learning_rate   | 0.001     |
|    n_updates       | 72315     |
----------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 6.29e+04  |
| time/              |           |
|    episodes        | 36        |
|    fps             | 198       |
|    time_elapsed    | 410       |
|    total_timesteps | 81468     |
| train/             |           |
|    actor_loss      | -3.35e+04 |
|    critic_loss     | 1.08e+06  |
|    learning_rate   | 0.001     |
|    n_updates       | 81367     |
----------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 6.51e+04  |
| time/              |           |
|    episodes        | 40        |
|    fps             | 198       |
|    time_elapsed    | 455       |
|    total_timesteps | 90520     |
| train/             |           |
|    actor_loss      | -3.12e+04 |
|    critic_loss     | 9.93e+05  |
|    learning_rate   | 0.001     |
|    n_updates       | 90419     |
----------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 6.65e+04  |
| time/              |           |
|    episodes        | 44        |
|    fps             | 198       |
|    time_elapsed    | 502       |
|    total_timesteps | 99572     |
| train/             |           |
|    actor_loss      | -2.81e+04 |
|    critic_loss     | 8.35e+05  |
|    learning_rate   | 0.001     |
|    n_updates       | 99471     |
----------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 6.85e+04  |
| time/              |           |
|    episodes        | 48        |
|    fps             | 197       |
|    time_elapsed    | 549       |
|    total_timesteps | 108624    |
| train/             |           |
|    actor_loss      | -2.49e+04 |
|    critic_loss     | 9.51e+05  |
|    learning_rate   | 0.001     |
|    n_updates       | 108523    |
----------------------------------
---------------------------------
| rollout/           |          |
|    ep_len_mean     | 2.26e+03 |
|    ep_rew_mean     | 7.11e+04 |
| time/              |          |
|    episodes        | 52       |
|    fps             | 197      |
|    time_elapsed    | 595      |
|    total_timesteps | 117676   |
| train/             |          |
|    actor_loss      | -2.1e+04 |
|    critic_loss     | 7.62e+05 |
|    learning_rate   | 0.001    |
|    n_updates       | 117575   |
---------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 7.31e+04  |
| time/              |           |
|    episodes        | 56        |
|    fps             | 196       |
|    time_elapsed    | 644       |
|    total_timesteps | 126728    |
| train/             |           |
|    actor_loss      | -1.97e+04 |
|    critic_loss     | 6.83e+05  |
|    learning_rate   | 0.001     |
|    n_updates       | 126627    |
----------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 7.57e+04  |
| time/              |           |
|    episodes        | 60        |
|    fps             | 195       |
|    time_elapsed    | 693       |
|    total_timesteps | 135780    |
| train/             |           |
|    actor_loss      | -1.73e+04 |
|    critic_loss     | 9.77e+05  |
|    learning_rate   | 0.001     |
|    n_updates       | 135679    |
----------------------------------
---------------------------------
| rollout/           |          |
|    ep_len_mean     | 2.26e+03 |
|    ep_rew_mean     | 7.74e+04 |
| time/              |          |
|    episodes        | 64       |
|    fps             | 196      |
|    time_elapsed    | 738      |
|    total_timesteps | 144832   |
| train/             |          |
|    actor_loss      | -1.5e+04 |
|    critic_loss     | 9.6e+05  |
|    learning_rate   | 0.001    |
|    n_updates       | 144731   |
---------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 7.94e+04  |
| time/              |           |
|    episodes        | 68        |
|    fps             | 197       |
|    time_elapsed    | 780       |
|    total_timesteps | 153884    |
| train/             |           |
|    actor_loss      | -1.41e+04 |
|    critic_loss     | 9.79e+05  |
|    learning_rate   | 0.001     |
|    n_updates       | 153783    |
----------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 8.17e+04  |
| time/              |           |
|    episodes        | 72        |
|    fps             | 197       |
|    time_elapsed    | 826       |
|    total_timesteps | 162936    |
| train/             |           |
|    actor_loss      | -1.56e+04 |
|    critic_loss     | 1.63e+06  |
|    learning_rate   | 0.001     |
|    n_updates       | 162835    |
----------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 8.39e+04  |
| time/              |           |
|    episodes        | 76        |
|    fps             | 196       |
|    time_elapsed    | 874       |
|    total_timesteps | 171988    |
| train/             |           |
|    actor_loss      | -1.23e+04 |
|    critic_loss     | 9.9e+05   |
|    learning_rate   | 0.001     |
|    n_updates       | 171887    |
----------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 8.61e+04  |
| time/              |           |
|    episodes        | 80        |
|    fps             | 196       |
|    time_elapsed    | 923       |
|    total_timesteps | 181040    |
| train/             |           |
|    actor_loss      | -1.08e+04 |
|    critic_loss     | 1.05e+06  |
|    learning_rate   | 0.001     |
|    n_updates       | 180939    |
----------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 8.85e+04  |
| time/              |           |
|    episodes        | 84        |
|    fps             | 195       |
|    time_elapsed    | 972       |
|    total_timesteps | 190092    |
| train/             |           |
|    actor_loss      | -8.71e+03 |
|    critic_loss     | 1.21e+06  |
|    learning_rate   | 0.001     |
|    n_updates       | 189991    |
----------------------------------
----------------------------------
| rollout/           |           |
|    ep_len_mean     | 2.26e+03  |
|    ep_rew_mean     | 9.1e+04   |
| time/              |           |
|    episodes        | 88        |
|    fps             | 194       |
|    time_elapsed    | 1021      |
|    total_timesteps | 199144    |
| train/             |           |
|    actor_loss      | -7.64e+03 |
|    critic_loss     | 1.05e+06  |
|    learning_rate   | 0.001     |
|    n_updates       | 199043    |
----------------------------------
>>> Модель сохранена в /home/artem/PycharmProjects/Book/rl-trading-coursework/results/ddpg_improved_portfolio.zip
>>> Оцениваем на Validation (2019–2020) …
Validation ROI:   24.59%
Validation Sharpe: 0.51
Validation MaxDD:  32.39%
Final net worth (Validation): 124591.45
>>> Equity-кривая Validation сохранена в results/equity_val_ddpg_portfolio.csv
>>> Оцениваем на Test (2021–2024) …
Test ROI:   -11.63%
Test Sharpe: 0.06
Test MaxDD:  52.28%
Final net worth (Test): 88370.29
>>> Equity-кривая Test сохранена в results/equity_test_ddpg_portfolio.csv
